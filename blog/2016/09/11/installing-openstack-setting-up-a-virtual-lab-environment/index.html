<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.93.3" />

  <title>Installing OpenStack ‚Äì setting up a virtual lab environment &middot; Calgary RHCE</title>

  <meta name="description" content="" />

  
  <meta property="og:locale" content="en-us"/>

  
  <meta property="og:image" content="https://calgaryrhce.ca/wp-content/uploads/2016/08/cropped-1477782_10152102853181489_71278912_n.jpg">

  
  <meta property="og:site_name" content="Calgary RHCE"/>
  <meta property="og:title" content="Installing OpenStack ‚Äì setting up a virtual lab environment"/>
  <meta property="og:description" content="When talking TripleO, there‚Äôs two concepts introduced called the ‚Äúundercloud‚Äù, and the ‚Äúovercloud‚Äù. These are essentially the labels for each OpenStack environment when referring to ‚ÄúOpenStack on OpenStack‚Äù (TripleO). The undercloud is the OpenStack server that manages and deploys the more publicly consumable overcloud servers that make up the OpenStack environment that we‚Äôre after."/>
  <meta property="og:url" content="https://calgaryrhce.ca/blog/2016/09/11/installing-openstack-setting-up-a-virtual-lab-environment/"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2016-09-11T22:16:08Z"/>
  <meta property="article:modified_time" content="2016-09-11T22:16:08Z"/>
  <meta property="article:author" content="Andrew Ludwar">
  
  
  

  <script type="application/ld+json">
  {
    "@context" : "http://schema.org",
    "@type" : "Blog",
    "name": "Calgary RHCE",
    "url" : "https://calgaryrhce.ca/",
    "image": "https://calgaryrhce.ca/wp-content/uploads/2016/08/cropped-1477782_10152102853181489_71278912_n.jpg",
    "description": "A linux and open source technology blog."
  }
  </script>

  
  <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "name": "Installing OpenStack ‚Äì setting up a virtual lab environment",
    "headline": "Installing OpenStack ‚Äì setting up a virtual lab environment",
    "datePublished": "2016-09-11T22:16:08Z",
    "dateModified": "2016-09-11T22:16:08Z",
    "author": {
      "@type": "Person",
      "name": "Andrew Ludwar",
      "url": "https://calgaryrhce.ca/"
    },
    "image": "https://calgaryrhce.ca/wp-content/uploads/2016/08/cropped-1477782_10152102853181489_71278912_n.jpg",
    "url": "https://calgaryrhce.ca/blog/2016/09/11/installing-openstack-setting-up-a-virtual-lab-environment/",
    "description": "When talking TripleO, there‚Äôs two concepts introduced called the ‚Äúundercloud‚Äù, and the ‚Äúovercloud‚Äù. These are essentially the labels for each OpenStack environment when referring to ‚ÄúOpenStack on OpenStack‚Äù (TripleO). The undercloud is the OpenStack server that manages and deploys the more publicly consumable overcloud servers that make up the OpenStack environment that we‚Äôre after."
  }
  </script>
  


  <link type="text/css"
        rel="stylesheet"
        href="https://calgaryrhce.ca/css/print.css"
        media="print">

  <link type="text/css"
        rel="stylesheet"
        href="https://calgaryrhce.ca/css/poole.css">

  <link type="text/css"
        rel="stylesheet"
        href="https://calgaryrhce.ca/css/hyde.css">

  
<style type="text/css">
  .sidebar {
    background-color: #990000;
  }

  .read-more-link a {
    border-color: #990000;
  }

  footer a,
  .content a,
  .related-posts li a:hover {
    color: #990000;
  }
</style>



  

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700&display=swap">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
        integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
        crossorigin="anonymous" />

  <link rel="apple-touch-icon-precomposed"
        sizes="144x144"
        href="/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/favicon.png">

  
  </head>
<body>
  <aside class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      
        
        <div class="author-image">
          <img src="https://calgaryrhce.ca/wp-content/uploads/2016/08/cropped-1477782_10152102853181489_71278912_n.jpg" class="img-circle img-headshot center" alt="Profile Picture">
        </div>
        
      

      <h1>Calgary RHCE</h1>

      
      <p class="lead">A linux and open source technology blog.</p>
      
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li>
          <a href="https://calgaryrhce.ca/">Home</a>
        </li>
        <li>
          <a href="/posts/"> Posts </a>
        </li><li>
          <a href="/about/"> About </a>
        </li>
      </ul>
    </nav>

    <section class="social-icons">
      
      <a href="https://ca.linkedin.com/in/andrewludwar" rel="me" title="Linkedin">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
      
      <a href="https://github.com/aludwar" rel="me" title="GitHub">
        <i class="fab fa-github" aria-hidden="true"></i>
      </a>
      
      <a href="https://twitter.com/andrewludwar" rel="me" title="Twitter">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      
    </section>
  </div>
</aside>


  <main class="content container">
  <div class="post">
  <h1>Installing OpenStack ‚Äì setting up a virtual lab environment</h1>

  <div class="post-date">
    <time datetime="2016-09-11T22:16:08Z">Sep 11, 2016</time> ¬∑ 4 min read
  </div>

  <p>When talking <a href="http://tripleo.org/">TripleO</a>, there‚Äôs two concepts introduced called the ‚Äúundercloud‚Äù, and the ‚Äúovercloud‚Äù. These are essentially the labels for each OpenStack environment when referring to ‚ÄúOpenStack on OpenStack‚Äù (TripleO). The undercloud is the OpenStack server that manages and deploys the more publicly consumable overcloud servers that make up the OpenStack environment that we‚Äôre after. Confused yet? üôÇ <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Marcos Garcia <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->does a good job of illustrating this in a <a href="http://redhatstackblog.redhat.com/2016/07/27/tripleo-director-components-in-detail/">blog post</a>:</p>
<p><a href="https://calgaryrhce.ca/wp-content/uploads/2016/09/undercloud-vs-overcloud.png"><!-- raw HTML omitted --></a></p>
<p>To start with our OpenStack deployment, we‚Äôll first start with setting up the undercloud server.¬† We‚Äôre basically going to run through the recommended 10 node deployment in the <a href="https://access.redhat.com/documentation/en/red-hat-openstack-platform/9/single/director-installation-and-usage#sect-Environment_Requirements">Director installation guide</a>. I‚Äôm using the latest RHEL7.2 as my OS, and have created a VM with the following specs:</p>
<ul>
<li>16 GB RAM</li>
<li>8 vCPUs</li>
<li>80 GB disk</li>
<li>2 NICs, (one for a provisioning network, one for an external network)</li>
</ul>
<p>I‚Äôll be using libvirt/KVM to set this up. I‚Äôve created a linux bridge on my physical server, then have created a libvirt network on top of that. This network will be my provisioning network, and the linux bridge on it‚Äôs own will act as the external network for my OpenStack environment. We‚Äôre basically going with a single NIC deployment for simplicity sake, and are simulating trunking all the networks through this NIC, each with respective subnets. Don‚Äôt worry about that for now, more on that later. Make sure DHCP is disabled on the provisioning network:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>(Or if you‚Äôre a GUI person):</p>
<p><a href="https://calgaryrhce.ca/wp-content/uploads/2016/09/virtual-networks.png"><!-- raw HTML omitted --></a></p>
<p>While that covers the undercloud VM, let‚Äôs now create the overcloud VMs. We‚Äôre going to be using 3 controllers, 3 computes, and 3 ceph storage nodes for our deployment. They‚Äôll have the following specs:</p>
<ul>
<li><strong>Controller:</strong> 1 vCPU, 6 GB RAM, 40 GB disk, 2 NICs (first NIC is on the provisioning network, second is on the linux bridge)</li>
<li><strong>Compue</strong>: 4 vCPU, 6 GB RAM, 40 GB disk, 1 NIC (provisioning network)</li>
<li><strong>Storage:</strong> 1 vCPU, 6 GB RAM, 40 GB disk (OS), 8 GB disk (simulate ceph journal SSD), 100 GB disk (ceph osd), 1 NIC (provisioning network)</li>
</ul>
<p>The reason we‚Äôre using 3 of each node is that it gives you <a href="https://en.wikipedia.org/wiki/Quorum_(distributed_computing)">true high availability</a> with the controllers, as well as as much of a simulation of real world compute and software-defined-storage functionality. On your physical server, you want to make sure that virtualization extensions are enabled in the BIOS, and on your compute nodes you either inherit the host‚Äôs CPU characteristics, or you manually enable nested virtualization. This isn‚Äôt necessary for the overcloud deployment itself, but it is necessary to create an instance inside the OpenStack environment.</p>
<p>To enable nested virtualization, on both the hypervisor and compute nodes set this value in/etc/modprobe.d/kvm.conf</p>
<!-- raw HTML omitted -->
<p>To see if nested virtualization is enabled:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Once your undercloud VM is installed with the latest RHEL, you can continue with the steps in Chapter 4 of the <a href="https://access.redhat.com/documentation/en/red-hat-openstack-platform/9/single/director-installation-and-usage#chap-Installing_the_Undercloud">install guide</a>. Setup the stack user, create two directories, validate the hostname is set, register your system, enable the proper repos, update and reboot:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Then, install the director (TripleO) packages:</p>
<!-- raw HTML omitted -->
<p>The undercloud.conf file is where we make the configuration settings for the undercloud openstack environment. You can read through the guide for more details, but my undercloud.conf file looks like this. I‚Äôve copied the default in, and grep‚Äôd out my changes. With my network gateway the first IP of my provisioning network (172.16.108.1), I‚Äôve set that, as well as the undercloud server IP (172.16.108.2), and the remaining settings you can read. An important setting to note is the local_interface is set to the provisioning NIC on my VM (eth0 in this case, eth1 is my external linux bridge network):</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Now that we‚Äôve specified the undercloud‚Äôs configuration, we can run the install command that will install and setup the undercloud OpenStack software. Before we do this, I recommend taking a snapshot of the VM for easy rollback capability. You might decide later that you‚Äôve made a configuration mistake, or that you want to redeploy from scratch. Regarding the overall networking layout, essentially what we‚Äôre deploying is this:</p>
<p><a href="https://calgaryrhce.ca/wp-content/uploads/2016/09/network-openstack.png"><!-- raw HTML omitted --></a></p>
<p>Nic 1 on each node is essentially acting as a trunk, carrying all the types of traffic in the OpenStack environment that aren‚Äôt on the external network. In an actual production deployment, you may want to separate these out further into their own physical networks, bonds, VLANs, etc. But for our purposes, everything is going to be on one NIC, in the 172.16.108.0/24 subnet. Because we‚Äôre using a virtual environment, we‚Äôre also omitting the IPMI network. Our node out-of-band management is going to be handled by the <a href="https://access.redhat.com/documentation/en/red-hat-openstack-platform/9/single/director-installation-and-usage#sect-SSH_and_Virsh">pxe_ssh driver</a>. With this driver, the undercloud uses virsh to control the power management of our VMs.</p>
<!-- raw HTML omitted -->
<p>Finally, after several minutes, you should see a successful installation complete message:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Congratulations, TripleO has been installed and configured. We‚Äôre ready to start the configuration of the overcloud nodes. Next post, I will get into the heat templates required to do this, and some notable configuration items in them.</p>

</div>


  </main>

  <footer>
  <div class="copyright">
    &copy;  2022 ¬∑ 
  </div>
</footer>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/js/all.min.js"
          integrity="sha256-MAgcygDRahs+F/Nk5Vz387whB4kSK9NXlDN3w58LLq0="
          crossorigin="anonymous"></script>

  

  
</body>
</html>
